[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;34mStream Priority æµ‹è¯•å¥—ä»¶[0m
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m

æœ¬æµ‹è¯•å¥—ä»¶ç”¨äºéªŒè¯ AMD GPU ä¸Š Stream å’Œ Queue çš„ç‹¬ç«‹æ€§ã€‚

æµ‹è¯•å†…å®¹:
  1. å•è¿›ç¨‹åˆ›å»º 4 ä¸ªä¸åŒä¼˜å…ˆçº§çš„ Stream
  2. éªŒè¯æ¯ä¸ª Stream æœ‰ç‹¬ç«‹çš„åœ°å€
  3. éªŒè¯æ¯ä¸ª Stream å¯ä»¥ç‹¬ç«‹æäº¤ kernel
  4. ä½¿ç”¨ rocprofv3 è¿½è¸ª Queue ä¿¡æ¯
  5. ä½¿ç”¨ dmesg æŸ¥çœ‹å†…æ ¸æ—¥å¿—

è¿è¡Œæ–¹å¼:
  åŸºæœ¬æµ‹è¯•:   ./run_test.sh
  å®Œæ•´æµ‹è¯•:   sudo ./run_test.sh
  
æ‰‹åŠ¨æµ‹è¯•:
  ç¼–è¯‘:       make all
  å•è¿›ç¨‹:     ./test_concurrent
  åº”ç”¨ A:     ./test_app_A
  åº”ç”¨ B:     ./test_app_B
  è¿½è¸ª:       rocprofv3 --hip-trace ./test_concurrent

[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;34mæ£€æŸ¥ä¾èµ–[0m
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;32mâœ… hipcc å·²å®‰è£…[0m
[0;32mâœ… rocprofv3 å·²å®‰è£…[0m

[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;34mç¼–è¯‘æµ‹è¯•ç¨‹åº[0m
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
hipcc -O2 -g test_app_A.cpp -o test_app_A
test_app_A.cpp:33:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   33 |     hipGetDevice(&device);
      |     ^~~~~~~~~~~~ ~~~~~~~
test_app_A.cpp:36:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   36 |     hipGetDeviceProperties(&prop, device);
      |     ^~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
/opt/rocm-7.0.2/lib/llvm/bin/../../../include/hip/hip_runtime_api.h:102:32: note: expanded from macro 'hipGetDeviceProperties'
  102 | #define hipGetDeviceProperties hipGetDevicePropertiesR0600
      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_A.cpp:78:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   78 |     hipMalloc(&d_data1, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_A.cpp:79:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   79 |     hipMalloc(&d_data2, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_A.cpp:95:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   95 |     hipStreamSynchronize(stream_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_A.cpp:103:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  103 |     hipStreamSynchronize(stream_low);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~
test_app_A.cpp:108:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  108 |     hipStreamGetPriority(stream_high, &priority_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_A.cpp:109:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  109 |     hipStreamGetPriority(stream_low, &priority_low);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_A.cpp:131:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  131 |     hipFree(d_data1);
      |     ^~~~~~~ ~~~~~~~
test_app_A.cpp:132:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  132 |     hipFree(d_data2);
      |     ^~~~~~~ ~~~~~~~
test_app_A.cpp:133:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  133 |     hipStreamDestroy(stream_high);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_A.cpp:134:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  134 |     hipStreamDestroy(stream_low);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~
12 warnings generated when compiling for gfx942.
test_app_A.cpp:33:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   33 |     hipGetDevice(&device);
      |     ^~~~~~~~~~~~ ~~~~~~~
test_app_A.cpp:36:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   36 |     hipGetDeviceProperties(&prop, device);
      |     ^~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
/opt/rocm-7.0.2/lib/llvm/bin/../../../include/hip/hip_runtime_api.h:102:32: note: expanded from macro 'hipGetDeviceProperties'
  102 | #define hipGetDeviceProperties hipGetDevicePropertiesR0600
      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_A.cpp:78:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   78 |     hipMalloc(&d_data1, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_A.cpp:79:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   79 |     hipMalloc(&d_data2, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_A.cpp:95:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   95 |     hipStreamSynchronize(stream_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_A.cpp:103:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  103 |     hipStreamSynchronize(stream_low);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~
test_app_A.cpp:108:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  108 |     hipStreamGetPriority(stream_high, &priority_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_A.cpp:109:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  109 |     hipStreamGetPriority(stream_low, &priority_low);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_A.cpp:131:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  131 |     hipFree(d_data1);
      |     ^~~~~~~ ~~~~~~~
test_app_A.cpp:132:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  132 |     hipFree(d_data2);
      |     ^~~~~~~ ~~~~~~~
test_app_A.cpp:133:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  133 |     hipStreamDestroy(stream_high);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_A.cpp:134:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  134 |     hipStreamDestroy(stream_low);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~
12 warnings generated when compiling for host.
hipcc -O2 -g test_app_B.cpp -o test_app_B
test_app_B.cpp:33:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   33 |     hipGetDevice(&device);
      |     ^~~~~~~~~~~~ ~~~~~~~
test_app_B.cpp:36:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   36 |     hipGetDeviceProperties(&prop, device);
      |     ^~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
/opt/rocm-7.0.2/lib/llvm/bin/../../../include/hip/hip_runtime_api.h:102:32: note: expanded from macro 'hipGetDeviceProperties'
  102 | #define hipGetDeviceProperties hipGetDevicePropertiesR0600
      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_B.cpp:78:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   78 |     hipMalloc(&d_data1, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_B.cpp:79:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   79 |     hipMalloc(&d_data2, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_B.cpp:94:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   94 |     hipStreamSynchronize(stream_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_B.cpp:102:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  102 |     hipStreamSynchronize(stream_normal);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
test_app_B.cpp:107:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  107 |     hipStreamGetPriority(stream_high, &priority_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_B.cpp:108:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  108 |     hipStreamGetPriority(stream_normal, &priority_normal);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_B.cpp:130:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  130 |     hipFree(d_data1);
      |     ^~~~~~~ ~~~~~~~
test_app_B.cpp:131:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  131 |     hipFree(d_data2);
      |     ^~~~~~~ ~~~~~~~
test_app_B.cpp:132:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  132 |     hipStreamDestroy(stream_high);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_B.cpp:133:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  133 |     hipStreamDestroy(stream_normal);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
12 warnings generated when compiling for gfx942.
test_app_B.cpp:33:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   33 |     hipGetDevice(&device);
      |     ^~~~~~~~~~~~ ~~~~~~~
test_app_B.cpp:36:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   36 |     hipGetDeviceProperties(&prop, device);
      |     ^~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
/opt/rocm-7.0.2/lib/llvm/bin/../../../include/hip/hip_runtime_api.h:102:32: note: expanded from macro 'hipGetDeviceProperties'
  102 | #define hipGetDeviceProperties hipGetDevicePropertiesR0600
      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_B.cpp:78:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   78 |     hipMalloc(&d_data1, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_B.cpp:79:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   79 |     hipMalloc(&d_data2, size);
      |     ^~~~~~~~~ ~~~~~~~~~~~~~~
test_app_B.cpp:94:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   94 |     hipStreamSynchronize(stream_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_B.cpp:102:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  102 |     hipStreamSynchronize(stream_normal);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
test_app_B.cpp:107:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  107 |     hipStreamGetPriority(stream_high, &priority_high);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_B.cpp:108:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  108 |     hipStreamGetPriority(stream_normal, &priority_normal);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_app_B.cpp:130:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  130 |     hipFree(d_data1);
      |     ^~~~~~~ ~~~~~~~
test_app_B.cpp:131:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  131 |     hipFree(d_data2);
      |     ^~~~~~~ ~~~~~~~
test_app_B.cpp:132:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  132 |     hipStreamDestroy(stream_high);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~~
test_app_B.cpp:133:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  133 |     hipStreamDestroy(stream_normal);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
12 warnings generated when compiling for host.
hipcc -O2 -g test_concurrent.cpp -o test_concurrent
test_concurrent.cpp:34:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   34 |     hipGetDevice(&device);
      |     ^~~~~~~~~~~~ ~~~~~~~
test_concurrent.cpp:37:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   37 |     hipGetDeviceProperties(&prop, device);
      |     ^~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
/opt/rocm-7.0.2/lib/llvm/bin/../../../include/hip/hip_runtime_api.h:102:32: note: expanded from macro 'hipGetDeviceProperties'
  102 | #define hipGetDeviceProperties hipGetDevicePropertiesR0600
      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:49:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   49 |     hipStreamCreateWithPriority(&stream_A1, hipStreamDefault, -1);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:53:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   53 |     hipStreamCreateWithPriority(&stream_A2, hipStreamDefault, 1);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:62:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   62 |     hipStreamCreateWithPriority(&stream_B1, hipStreamDefault, -1);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:66:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   66 |     hipStreamCreateWithPriority(&stream_B2, hipStreamDefault, 0);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:94:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   94 |         hipMalloc(&d_data[i], size);
      |         ^~~~~~~~~ ~~~~~~~~~~~~~~~~
test_concurrent.cpp:108:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  108 |     hipStreamGetPriority(stream_A1, &priorities[0]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:109:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  109 |     hipStreamGetPriority(stream_A2, &priorities[1]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:110:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  110 |     hipStreamGetPriority(stream_B1, &priorities[2]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:111:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  111 |     hipStreamGetPriority(stream_B2, &priorities[3]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:125:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  125 |     hipStreamSynchronize(stream_A1);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:131:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  131 |     hipStreamSynchronize(stream_A2);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:137:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  137 |     hipStreamSynchronize(stream_B1);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:143:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  143 |     hipStreamSynchronize(stream_B2);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:160:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  160 |         hipStreamSynchronize(stream_A1);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:161:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  161 |         hipStreamSynchronize(stream_A2);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:162:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  162 |         hipStreamSynchronize(stream_B1);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:163:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  163 |         hipStreamSynchronize(stream_B2);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:190:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  190 |         hipFree(d_data[i]);
      |         ^~~~~~~ ~~~~~~~~~
test_concurrent.cpp:193:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  193 |     hipStreamDestroy(stream_A1);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:194:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  194 |     hipStreamDestroy(stream_A2);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:195:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  195 |     hipStreamDestroy(stream_B1);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:196:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  196 |     hipStreamDestroy(stream_B2);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
24 warnings generated when compiling for gfx942.
test_concurrent.cpp:34:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   34 |     hipGetDevice(&device);
      |     ^~~~~~~~~~~~ ~~~~~~~
test_concurrent.cpp:37:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   37 |     hipGetDeviceProperties(&prop, device);
      |     ^~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~
/opt/rocm-7.0.2/lib/llvm/bin/../../../include/hip/hip_runtime_api.h:102:32: note: expanded from macro 'hipGetDeviceProperties'
  102 | #define hipGetDeviceProperties hipGetDevicePropertiesR0600
      |                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:49:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   49 |     hipStreamCreateWithPriority(&stream_A1, hipStreamDefault, -1);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:53:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   53 |     hipStreamCreateWithPriority(&stream_A2, hipStreamDefault, 1);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:62:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   62 |     hipStreamCreateWithPriority(&stream_B1, hipStreamDefault, -1);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:66:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   66 |     hipStreamCreateWithPriority(&stream_B2, hipStreamDefault, 0);
      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:94:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
   94 |         hipMalloc(&d_data[i], size);
      |         ^~~~~~~~~ ~~~~~~~~~~~~~~~~
test_concurrent.cpp:108:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  108 |     hipStreamGetPriority(stream_A1, &priorities[0]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:109:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  109 |     hipStreamGetPriority(stream_A2, &priorities[1]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:110:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  110 |     hipStreamGetPriority(stream_B1, &priorities[2]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:111:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  111 |     hipStreamGetPriority(stream_B2, &priorities[3]);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~
test_concurrent.cpp:125:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  125 |     hipStreamSynchronize(stream_A1);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:131:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  131 |     hipStreamSynchronize(stream_A2);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:137:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  137 |     hipStreamSynchronize(stream_B1);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:143:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  143 |     hipStreamSynchronize(stream_B2);
      |     ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:160:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  160 |         hipStreamSynchronize(stream_A1);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:161:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  161 |         hipStreamSynchronize(stream_A2);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:162:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  162 |         hipStreamSynchronize(stream_B1);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:163:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  163 |         hipStreamSynchronize(stream_B2);
      |         ^~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:190:9: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  190 |         hipFree(d_data[i]);
      |         ^~~~~~~ ~~~~~~~~~
test_concurrent.cpp:193:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  193 |     hipStreamDestroy(stream_A1);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:194:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  194 |     hipStreamDestroy(stream_A2);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:195:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  195 |     hipStreamDestroy(stream_B1);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
test_concurrent.cpp:196:5: warning: ignoring return value of function declared with 'nodiscard' attribute [-Wunused-result]
  196 |     hipStreamDestroy(stream_B2);
      |     ^~~~~~~~~~~~~~~~ ~~~~~~~~~
24 warnings generated when compiling for host.
[0;32mâœ… æ‰€æœ‰ç¨‹åºç¼–è¯‘æˆåŠŸ[0m

[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;34mæµ‹è¯• 1: å•è¿›ç¨‹ 4 ä¸ª Stream[0m
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ„¹ï¸  è¿è¡Œ test_concurrent...[0m

/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
/opt/amdgpu/share/libdrm/amdgpu.ids: No such file or directory
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å¹¶å‘æµ‹è¯• - 4 ä¸ª Stream çš„ç‹¬ç«‹æ€§éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PID: 444735

GPU Device: AMD Radeon Graphics

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
é˜¶æ®µ 1: åˆ›å»º Streamï¼ˆæ¨¡æ‹Ÿåº”ç”¨ Aï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… [åº”ç”¨ A] Stream-1 (HIGH):   0x154f950
âœ… [åº”ç”¨ A] Stream-2 (LOW):    0x1c9fed0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
é˜¶æ®µ 2: åˆ›å»º Streamï¼ˆæ¨¡æ‹Ÿåº”ç”¨ Bï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… [åº”ç”¨ B] Stream-3 (HIGH):   0x158f690
âœ… [åº”ç”¨ B] Stream-4 (NORMAL): 0x1597900

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
éªŒè¯: æ‰€æœ‰ Stream åœ°å€å”¯ä¸€æ€§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… æ‰€æœ‰ 4 ä¸ª Stream åœ°å€å”¯ä¸€ â†’ 4 ä¸ªç‹¬ç«‹çš„ Stream å¯¹è±¡

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
é˜¶æ®µ 3: æäº¤ Kernel åˆ°æ‰€æœ‰ Stream
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æç¤º: è§‚å¯Ÿ Queue åˆ›å»ºæ¶ˆæ¯
æç¤º: ä½¿ç”¨ 'sudo dmesg -w' ç›‘æ§å†…æ ¸æ¶ˆæ¯

â”€â”€â”€ Stream ä¼˜å…ˆçº§ â”€â”€â”€
[åº”ç”¨ A] Stream-1: priority = -1 (HIGH)
[åº”ç”¨ A] Stream-2: priority =  1 (LOW)
[åº”ç”¨ B] Stream-3: priority = -1 (HIGH)
[åº”ç”¨ B] Stream-4: priority =  0 (NORMAL)

å¼€å§‹æäº¤ Kernel...

[1/4] [åº”ç”¨ A] Stream-1 (HIGH)   æäº¤ kernel...
      å®Œæˆ

[2/4] [åº”ç”¨ A] Stream-2 (LOW)    æäº¤ kernel...
      å®Œæˆ

[3/4] [åº”ç”¨ B] Stream-3 (HIGH)   æäº¤ kernel...
      å®Œæˆ

[4/4] [åº”ç”¨ B] Stream-4 (NORMAL) æäº¤ kernel...
      å®Œæˆ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
é˜¶æ®µ 4: å¹¶å‘æäº¤æµ‹è¯•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ‰€æœ‰ Stream å¹¶å‘æäº¤å¤šä¸ª kernel

è½®æ¬¡ 1:
  æ‰€æœ‰ Stream å®Œæˆ
è½®æ¬¡ 2:
  æ‰€æœ‰ Stream å®Œæˆ
è½®æ¬¡ 3:
  æ‰€æœ‰ Stream å®Œæˆ
è½®æ¬¡ 4:
  æ‰€æœ‰ Stream å®Œæˆ
è½®æ¬¡ 5:
  æ‰€æœ‰ Stream å®Œæˆ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
é˜¶æ®µ 5: ä¿æŒè¿è¡Œï¼ˆç”¨äºå¤–éƒ¨å·¥å…·æ£€æŸ¥ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æç¤º: æ­¤æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ£€æŸ¥:
  1. lsof -p 444735 | grep kfd
  2. cat /proc/444735/maps | grep doorbell
  3. sudo cat /sys/kernel/debug/kfd/queues

å‰©ä½™ 10 ç§’...å‰©ä½™  9 ç§’...å‰©ä½™  8 ç§’...å‰©ä½™  7 ç§’...å‰©ä½™  6 ç§’...å‰©ä½™  5 ç§’...å‰©ä½™  4 ç§’...å‰©ä½™  3 ç§’...å‰©ä½™  2 ç§’...å‰©ä½™  1 ç§’...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ¸…ç†èµ„æº
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… æ¸…ç†å®Œæˆ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æµ‹è¯•æ€»ç»“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… åˆ›å»ºäº† 4 ä¸ªç‹¬ç«‹çš„ Stream
âœ… æ¯ä¸ª Stream æœ‰å”¯ä¸€çš„åœ°å€
âœ… æ¯ä¸ª Stream æœ‰ç‹¬ç«‹çš„ä¼˜å…ˆçº§
âœ… æ‰€æœ‰ Stream å¯ä»¥å¹¶å‘æäº¤ kernel

ç»“è®º: æ¯ä¸ª Stream éƒ½æœ‰ç‹¬ç«‹çš„ HSA Queue å’Œ ring-buffer
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[0;32mâœ… æµ‹è¯• 1 å®Œæˆ[0m

[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;34mæµ‹è¯• 2: ä¸¤ä¸ªç‹¬ç«‹è¿›ç¨‹[0m
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ„¹ï¸  è¿™ä¸ªæµ‹è¯•éœ€è¦æ‰‹åŠ¨è¿è¡Œä¸¤ä¸ªç»ˆç«¯[0m
[1;33mâ„¹ï¸  ç»ˆç«¯ 1: ./test_app_A[0m
[1;33mâ„¹ï¸  ç»ˆç«¯ 2: ./test_app_B[0m

æŒ‰å›è½¦é”®ç»§ç»­ä¸‹ä¸€ä¸ªæµ‹è¯•...
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[0;34mæµ‹è¯• 3: ä½¿ç”¨ rocprofv3 è¿½è¸ª[0m
[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ„¹ï¸  è¿è¡Œ rocprofv3 --hip-trace ./test_concurrent[0m

usage: rocprofv3 [options] -- <application> [application options]
rocprofv3: error: unrecognized arguments: ./test_concurrent
