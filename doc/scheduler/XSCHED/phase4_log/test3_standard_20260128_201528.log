========================================================================
Phase 4: Dual Model Priority Scheduling Test
========================================================================

Test Configuration:
  Duration: 60s
  High Priority: ResNet-18 (10 reqs/sec)
  Low Priority:  ResNet-50 (continuous)

[1/5] Copying test script to container...
  ‚úÖ Script copied

========================================================================
[2/5] Running BASELINE test (Native scheduler, no XSched)
========================================================================

======================================================================
Phase 4: Dual Model Priority Scheduling Test
======================================================================

Test configuration:
  Duration: 60s
  High priority: ResNet-18, 10 reqs/sec
  Low priority:  ResNet-50, continuous

‚ÑπÔ∏è  Running with Native scheduler (no XSched)

Starting workers...
----------------------------------------------------------------------
[HIGH] Starting high priority task (ResNet-18)
[HIGH] Target: 10 reqs/sec, Duration: 60s
[HIGH] Warmup completed, starting test...

[HIGH] Results:
  Requests: 600
  Throughput: 9.99 req/s
  Latency Avg: 2.26 ms
  Latency P50: 2.25 ms
  Latency P95: 2.58 ms
  Latency P99: 2.65 ms
  Latency Max: 2.77 ms
[LOW] Starting low priority task (ResNet-50)
[LOW] Mode: Continuous inference, Duration: 60s
[LOW] Warmup completed, starting test...

[LOW] Results:
  Iterations: 9988
  Throughput: 166.46 iter/s
  Images/sec: 1331.7

======================================================================
FINAL RESULTS
======================================================================

High Priority (ResNet-18):
  P99 Latency: 2.65 ms
  Throughput:  9.99 req/s

Low Priority (ResNet-50):
  Throughput:  166.46 iter/s
  Images/sec:  1331.7

‚úÖ Results saved to /data/dockercode/test_results_phase4/baseline_result.json
======================================================================

‚úÖ High priority P99 (2.65ms) looks reasonable

========================================================================
[3/5] Running XSCHED test (With priority scheduling)
========================================================================

[INFO @ T65651 @ 12:16:49.375148] using app-managed scheduler
======================================================================
Phase 4: Dual Model Priority Scheduling Test
======================================================================

Test configuration:
  Duration: 60s
  High priority: ResNet-18, 10 reqs/sec
  Low priority:  ResNet-50, continuous

‚úÖ Running with XSched
   LD_PRELOAD: /data/dockercode/xsched-build/output/lib/libshimhip.so

Starting workers...
----------------------------------------------------------------------
MIOpen Error: /longer_pathname_so_that_rpms_can_support_packaging_the_debug_info_for_all_os_profiles/src/MIOpen/src/hipoc/hipoc_kernel.cpp:131: Failed to launch kernel: invalid device ordinal
Traceback (most recent call last):
  File "/data/dockercode/test_phase4_dual_model.py", line 48, in high_priority_worker
    _ = model(x)
        ^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torchvision/models/resnet.py", line 285, in forward
    return self._forward_impl(x)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torchvision/models/resnet.py", line 268, in _forward_impl
    x = self.conv1(x)
        ^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/conv.py", line 554, in forward
    return self._conv_forward(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/conv.py", line 549, in _conv_forward
    return F.conv2d(
           ^^^^^^^^^
RuntimeError: miopenStatusUnknownError
[HIGH] Starting high priority task (ResNet-18)
[HIGH] Target: 10 reqs/sec, Duration: 60s
[HIGH] Error: miopenStatusUnknownError
MIOpen Error: /longer_pathname_so_that_rpms_can_support_packaging_the_debug_info_for_all_os_profiles/src/MIOpen/src/hipoc/hipoc_kernel.cpp:131: Failed to launch kernel: invalid device ordinal
Traceback (most recent call last):
  File "/data/dockercode/test_phase4_dual_model.py", line 132, in low_priority_worker
    _ = model(x)
        ^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torchvision/models/resnet.py", line 285, in forward
    return self._forward_impl(x)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torchvision/models/resnet.py", line 268, in _forward_impl
    x = self.conv1(x)
        ^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/conv.py", line 554, in forward
    return self._conv_forward(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/py_3.12/lib/python3.12/site-packages/torch/nn/modules/conv.py", line 549, in _conv_forward
    return F.conv2d(
           ^^^^^^^^^
RuntimeError: miopenStatusUnknownError
[LOW] Starting low priority task (ResNet-50)
[LOW] Mode: Continuous inference, Duration: 60s
[LOW] Error: miopenStatusUnknownError

======================================================================
FINAL RESULTS
======================================================================

‚úÖ Results saved to /data/dockercode/test_results_phase4/xsched_result.json
======================================================================

========================================================================
[4/5] Comparing results...
========================================================================

======================================================================
COMPARISON: XSched vs Baseline
======================================================================

High Priority Task (ResNet-18):
----------------------------------------------------------------------


Low Priority Task (ResNet-50):
----------------------------------------------------------------------

======================================================================
SUMMARY
======================================================================

üéâ Overall: PASS

Key findings:
  - High priority task maintains good latency
  - Low priority task is not starved
  - XSched priority scheduling is working
======================================================================

========================================================================
[5/5] Generating final report...
========================================================================

cat: /data/dockercode/test_results_phase4/baseline_result.json: No such file or directory
Expecting value: line 1 column 1 (char 0)
cat: /data/dockercode/test_results_phase4/xsched_result.json: No such file or directory
Expecting value: line 1 column 1 (char 0)
‚úÖ Report generated: /data/dockercode/test_results_phase4/phase4_dual_model_report.md

========================================================================
‚úÖ Phase 4 Dual Model Test: PASSED
========================================================================

Results saved in:
  - Baseline:  zhenflashinfer_v1:/data/dockercode/test_results_phase4/baseline_result.json
  - XSched:    zhenflashinfer_v1:/data/dockercode/test_results_phase4/xsched_result.json
  - Report:    zhenflashinfer_v1:/data/dockercode/test_results_phase4/phase4_dual_model_report.md

View results:
  docker exec zhenflashinfer_v1 cat /data/dockercode/test_results_phase4/baseline_result.json
  docker exec zhenflashinfer_v1 cat /data/dockercode/test_results_phase4/xsched_result.json

Next step: Analyze results and proceed to Test 4.2 (Multi-tenant)
