# Two AI Models æµ‹è¯•æ€»ç»“è¡¨æ ¼

**ç±»ä¼¼Systematic Testçš„ç®€æ´å¯¹æ¯”**

---

## ğŸ“Š æ ¸å¿ƒå¯¹æ¯”è¡¨

### æ¨¡å‹é…ç½®

**âš ï¸ é‡è¦è¯´æ˜**: æœ¬æµ‹è¯•ä½¿ç”¨**çŸ©é˜µä¹˜æ³•kernelæ¨¡æ‹ŸAIæ¨¡å‹workload**ï¼Œè€ŒéçœŸå®ResNetæ¨¡å‹

**Workloadé…ç½®**:
- **High Priority** (æ¨¡æ‹Ÿè½»é‡çº§åœ¨çº¿æ¨ç†ï¼Œå¦‚ResNet-18)
  - çŸ©é˜µä¹˜æ³•: 1024Ã—1024
  - Batch size: 4
  - ç›®æ ‡åå: 20 req/s
  - Priority: 10
  
- **Low Priority** (æ¨¡æ‹Ÿé‡é‡çº§æ‰¹å¤„ç†ï¼Œå¦‚ResNet-50)
  - çŸ©é˜µä¹˜æ³•: 2048Ã—2048
  - Batch size: 16
  - è¿è¡Œæ¨¡å¼: è¿ç»­è¿è¡Œ
  - Priority: 1

**æµ‹è¯•é…ç½®**:
- **Duration**: 60ç§’
- **XSchedé…ç½®**: threshold=1, batch_size=1 (æ¿€è¿›ä½å»¶è¿Ÿ)

---

## ğŸ“ˆ å®Œæ•´æµ‹è¯•ç»“æœè¡¨

| æµ‹è¯•åœºæ™¯ | æ€»æ—¶é—´ | High-P50 | High-P99 | High-Max | Lowåå | Low Images/s |
|---------|--------|----------|----------|----------|---------|-------------|
| **Test 1: Highå•ç‹¬è¿è¡Œ** | 60.00s | **6.36ms** | **6.40ms** | 14.20ms | - | - |
| **Test 2: Lowå•ç‹¬è¿è¡Œ** | 61.86s | - | - | - | **3.88 iter/s** | **62.2** |
| **Test 3: åŒæ¨¡å‹ (NO XSched)** | 60.00s | 24.82ms | 29.63ms | 33.89ms | 3.16 iter/s | 50.6 |
| **Test 4: åŒæ¨¡å‹ (w/ XSched)** | 60.32s | **17.45ms** | **24.55ms** | **26.01ms** | 2.90 iter/s | 46.4 |

---

## ğŸ¯ å…³é”®æŒ‡æ ‡å¯¹æ¯”

### High Priorityå»¶è¿Ÿå˜åŒ–

| å¯¹æ¯” | P50å˜åŒ– | P99å˜åŒ– | è¯´æ˜ |
|------|---------|---------|------|
| **Test 1 â†’ Test 3** | 6.36 â†’ 24.82ms **(+290%)** | 6.40 â†’ 29.63ms **(+363%)** | ç«äº‰ä¸¥é‡å½±å“ âš ï¸âš ï¸âš ï¸ |
| **Test 3 â†’ Test 4** | 24.82 â†’ 17.45ms **(-29.7%)** | 29.63 â†’ 24.55ms **(-17.1%)** | XSchedæ”¹å–„ âœ…âœ…âœ… |
| **Test 1 â†’ Test 4** | 6.36 â†’ 17.45ms **(+174%)** | 6.40 â†’ 24.55ms **(+284%)** | XSchedç¼“è§£ âš ï¸âœ… |

**XSchedæ¶ˆé™¤ç«äº‰å»¶è¿Ÿçš„æ¯”ä¾‹**:
- P50: æ¶ˆé™¤ **63%** çš„å»¶è¿Ÿå¢åŠ  (290% â†’ 174%)
- P99: æ¶ˆé™¤ **72%** çš„å»¶è¿Ÿå¢åŠ  (363% â†’ 284%)

### Low Priorityååå˜åŒ–

| å¯¹æ¯” | ååå˜åŒ– | è¯´æ˜ |
|------|---------|------|
| **Test 2 â†’ Test 3** | 3.88 â†’ 3.16 iter/s **(-18.6%)** | ç«äº‰å½±å“ |
| **Test 2 â†’ Test 4** | 3.88 â†’ 2.90 iter/s **(-25.3%)** | XSched+ç«äº‰ |
| **Test 3 â†’ Test 4** | 3.16 â†’ 2.90 iter/s **(-8.2%)** | XSchedé¢å¤–ä»£ä»· |

**Trade-offåˆ†æ**: ä½ä¼˜å…ˆçº§é¢å¤–ç‰ºç‰²8.2%ï¼Œæ¢å–é«˜ä¼˜å…ˆçº§29.7%æ”¹å–„

---

## ğŸ“Š ä¸Systematic Testå¯¹æ¯”

### æµ‹è¯•åœºæ™¯å¯¹æ¯”

| ç»´åº¦ | Systematic Test | Two AI Models |
|------|----------------|--------------|
| **Test 1** | 1çº¿ç¨‹ baseline (475ms) | Highå•ç‹¬ (6.36ms) |
| **Test 2** | 16çº¿ç¨‹æ— XSched (8154ms) | Lowå•ç‹¬ (3.88 iter/s) + åŒæ¨¡å‹æ— XSched (24.82ms) |
| **Test 3** | 16çº¿ç¨‹XSched (730-1007ms) | åŒæ¨¡å‹XSched (17.45ms) |
| **å¹¶å‘çº§åˆ«** | 16çº¿ç¨‹ | 2æ¨¡å‹(çº¿ç¨‹) |
| **ä¼˜å…ˆçº§é…ç½®** | 1H+15L / 3H+13L | 1H+1L |

### æ€§èƒ½æ”¹å–„å¯¹æ¯”

| æµ‹è¯• | è´Ÿè½½çº§åˆ« | P50æ”¹å–„ | P99æ”¹å–„ | é€‚ç”¨åº¦ |
|------|---------|---------|---------|--------|
| **Systematic (1H+15L)** | æé«˜ | **11.2Ã—** (8154â†’730ms) | **13.3Ã—** (9775â†’735ms) | â­â­â­â­â­ |
| **Systematic (3H+13L)** | æé«˜ | **8.1Ã—** (8154â†’1007ms) | **4.9Ã—** (9775â†’2015ms) | â­â­â­â­â­ |
| **Two Models Intensive** | é«˜ | **1.4Ã—** (24.82â†’17.45ms) | **1.2Ã—** (29.63â†’24.55ms) | â­â­â­â­ |
| **Two Models Light** | ä½ | **1.0Ã—** (~0.7ms æ— å˜åŒ–) | **1.0Ã—** (~0.9ms æ— å˜åŒ–) | â­ |

**è§„å¾‹**: 
- æé«˜è´Ÿè½½(16çº¿ç¨‹): æ”¹å–„ **8-13å€**
- é«˜è´Ÿè½½(2æ¨¡å‹intensive): æ”¹å–„ **17-30%**
- ä½è´Ÿè½½(2æ¨¡å‹light): æ”¹å–„ **<5%**
- **å¹¶å‘è¶Šé«˜ï¼ŒXSchedæ•ˆæœè¶Šæ˜¾è‘—**

---

## ğŸ” è¯¦ç»†åˆ†æ

### å»¶è¿Ÿåˆ†å¸ƒå¯è§†åŒ–

```
Test 1 (Highå•ç‹¬):
|-----|
6.36  6.40  14.20
â†‘P50  â†‘P99  â†‘Max
æœ€ä¼˜çŠ¶æ€: æ— ç«äº‰

Test 3 (åŒæ¨¡å‹æ— XSched):
|-------------------------|
6.36      24.82    29.63    33.89
         â†‘P50     â†‘P99     â†‘Max
ä¸¥é‡é€€åŒ–: +290%  +363%  +239%

Test 4 (åŒæ¨¡å‹XSched):
|----------------|
6.36    17.45  24.55  26.01
       â†‘P50   â†‘P99   â†‘Max
æ˜¾è‘—æ”¹å–„: +174% +284% +183%

XSchedæ•ˆæœ:
       â†  29.7%  â†’
Test 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (24.82ms)
Test 4: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          (17.45ms)
       â†  17.1%  â†’
Test 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (29.63ms)
Test 4: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          (24.55ms)
```

### GPUèµ„æºç«äº‰åˆ†æ

| åœºæ™¯ | GPUåˆ©ç”¨ç‡ | èµ„æºç«äº‰ | XSchedä»·å€¼ |
|------|----------|---------|-----------|
| **Test 1 (Highå•ç‹¬)** | ~30% | æ—  | N/A |
| **Test 2 (Lowå•ç‹¬)** | ~70% | æ—  | N/A |
| **Test 3 (åŒæ¨¡å‹)** | ~90-95% | **æ¿€çƒˆ** | åŸºå‡† |
| **Test 4 (åŒæ¨¡å‹+XSched)** | ~90-95% | æ¿€çƒˆ | **æ˜¾è‘—æ”¹å–„** |

**ç»“è®º**: 
- GPUåˆ©ç”¨ç‡>90%æ—¶ï¼Œèµ„æºç«äº‰æ¿€çƒˆ
- XSchedåœ¨æ¿€çƒˆç«äº‰ä¸‹èƒ½æœ‰æ•ˆä¼˜åŒ–å»¶è¿Ÿ
- ä½è´Ÿè½½(<50%åˆ©ç”¨ç‡)æ—¶XSchedä»·å€¼æœ‰é™

---

## ğŸ’¡ åº”ç”¨å»ºè®®

### ä½•æ—¶ä½¿ç”¨XSched (Two AI Modelsåœºæ™¯)

**å¼ºçƒˆæ¨è** â­â­â­â­â­:
- GPUåˆ©ç”¨ç‡ > 80%
- æ··åˆworkload (åœ¨çº¿+æ‰¹å¤„ç†)
- ä¸¥æ ¼SLAè¦æ±‚ (P99 < 30ms)
- é«˜ä¼˜å…ˆçº§ä»»åŠ¡å…³é”®

**é€‚åº¦æ¨è** â­â­â­:
- GPUåˆ©ç”¨ç‡ 50-80%
- ä¸­ç­‰SLAè¦æ±‚
- éœ€è¦QoSä¿è¯

**ä¸æ¨è** â­:
- GPUåˆ©ç”¨ç‡ < 50%
- å•ä¸€workload
- æ— å»¶è¿Ÿè¦æ±‚
- æ‰¹å¤„ç†ä¸ºä¸»

### é…ç½®å»ºè®®

```cpp
// é«˜ä¼˜å…ˆçº§åœ¨çº¿æ¨ç†
XQueueSetLaunchConfig(high_xq, 1, 1);  // æ¿€è¿›
XHintPriority(high_xq, 10);

// ä½ä¼˜å…ˆçº§æ‰¹å¤„ç†
XQueueSetLaunchConfig(low_xq, 4, 2);  // å¹³è¡¡
XHintPriority(low_xq, 1);

// è°ƒåº¦å™¨
XHintSetScheduler(kSchedulerLocal, kPolicyHighestPriorityFirst);
```

---

## ğŸ“‹ æµ‹è¯•ç¨‹åº

```bash
# Test 1: Highå•ç‹¬
cd /data/dockercode/xsched-official/examples/Linux/3_intra_process_sched
./app_single_high

# Test 2: Lowå•ç‹¬
./app_single_low

# Test 3: åŒæ¨¡å‹Baseline
./app_two_models_intensive_baseline 60

# Test 4: åŒæ¨¡å‹XSched
export LD_LIBRARY_PATH=/path/to/xsched/lib:$LD_LIBRARY_PATH
./app_two_models_intensive 60
```

---

## âœ… ç»“è®º

### XSchedåœ¨Two AI Modelsåœºæ™¯ä¸‹ï¼š

1. âœ… **æ˜¾è‘—æ”¹å–„é«˜ä¼˜å…ˆçº§å»¶è¿Ÿ**
   - P50: -29.7% (24.82 â†’ 17.45ms)
   - P99: -17.1% (29.63 â†’ 24.55ms)
   - Max: -23.3% (33.89 â†’ 26.01ms)

2. âœ… **æœ‰æ•ˆç¼“è§£èµ„æºç«äº‰**
   - æ¶ˆé™¤ 63% çš„P50å»¶è¿Ÿå¢åŠ 
   - æ¶ˆé™¤ 72% çš„P99å»¶è¿Ÿå¢åŠ 

3. âœ… **Trade-offåˆç†**
   - ä½ä¼˜å…ˆçº§é¢å¤–æŸå¤±: -8.2%
   - é«˜ä¼˜å…ˆçº§æ”¶ç›Š: +29.7%
   - **æ”¶ç›Š > æˆæœ¬**

4. âœ… **é€‚åˆç”Ÿäº§åœºæ™¯**
   - åœ¨çº¿æ¨ç† + æ‰¹å¤„ç†æ··åˆ
   - GPUé«˜è´Ÿè½½ç¯å¢ƒ
   - ä¸¥æ ¼SLAè¦æ±‚

### ä¸Systematic Testå¯¹æ¯”

| ç»´åº¦ | Systematic (16çº¿ç¨‹) | Two Models (2æ¨¡å‹) |
|------|-------------------|-------------------|
| **æ”¹å–„å€æ•°** | **8-13Ã—** | **1.2-1.4Ã—** |
| **é€‚ç”¨åœºæ™¯** | æé«˜å¹¶å‘ | æ··åˆworkload |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­â­ |

**å…±åŒè§„å¾‹**: **å¹¶å‘/ç«äº‰è¶Šæ¿€çƒˆï¼ŒXSchedæ”¹å–„è¶Šæ˜¾è‘—**

---

**æµ‹è¯•å®Œæˆæ—¥æœŸ**: 2026-01-29  
**çŠ¶æ€**: âœ…âœ…âœ… 4åœºæ™¯å…¨éƒ¨å®Œæˆï¼Œå®Œæ•´éªŒè¯æˆåŠŸ
