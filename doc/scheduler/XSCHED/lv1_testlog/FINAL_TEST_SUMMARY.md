# XSched Level 1 ä¿®å¤åå®Œæ•´æµ‹è¯•æ€»ç»“

**æ—¥æœŸ**: 2026-01-29  
**å…³é”®çªç ´**: LaunchWrapperä¿®å¤ - Kernelsç°åœ¨æ­£ç¡®æ‰§è¡Œ  
**æµ‹è¯•çŠ¶æ€**: 2/3 å®Œæˆï¼ˆSystematic âœ…, 8-Thread âœ…, Two AI Models âš ï¸ï¼‰

---

## ğŸ¯ æ ¸å¿ƒæˆå°±

### âœ… é—®é¢˜ä¿®å¤æˆåŠŸ
**LaunchWrapper Kernelå‚æ•°é—®é¢˜**:
- **æ ¹å› **: `KernelParamManager`æ‰¾ä¸åˆ°å‚æ•°ä¿¡æ¯ â†’ `kernel_params_=NULL` â†’ `hipErrorInvalidValue`
- **ä¿®å¤**: æ·»åŠ fallbacké€»è¾‘ï¼Œä½¿ç”¨åŸå§‹`params`æŒ‡é’ˆ
- **ç»“æœ**: Kernelsç°åœ¨æ­£ç¡®æ‰§è¡Œï¼Œè¾“å‡ºæ­£ç¡®

### âœ… XSched Level 1 éªŒè¯æˆåŠŸ
**Progressive Command Launchingæœºåˆ¶**:
- XQueueç¼“å­˜å·¥ä½œæ­£å¸¸
- LaunchWorkeræäº¤æœºåˆ¶æ­£ç¡®  
- HPF (Highest Priority First)è°ƒåº¦æœ‰æ•ˆ
- ä¼˜å…ˆçº§è°ƒåº¦è¾¾åˆ°é¢„æœŸæ•ˆæœ

---

## ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»

### Test 1: Systematic Test (âœ… å®Œæˆ)

#### é…ç½®
- **Workload**: 2048x2048 çŸ©é˜µä¹˜æ³•
- **Kernels/task**: 30, **Tasks/thread**: 10
- **åœºæ™¯**: 1çº¿ç¨‹ã€16çº¿ç¨‹(æ— XSched)ã€16çº¿ç¨‹(3H+13L)ã€16çº¿ç¨‹(1H+15L)

#### ç»“æœ

**è¡¨æ ¼1: P50å»¶è¿Ÿå¯¹æ¯” (å•ä½: ms)**

| åœºæ™¯ | Single Thread | æ— XSched (16çº¿ç¨‹) | XSched (3High+13Low) | XSched (1High+15Low) |
|------|--------------|-------------------|---------------------|---------------------|
| **é«˜ä¼˜å…ˆçº§** | 475 | 8154 | **1007** âœ… | **730** âœ…âœ… |
| **ä½ä¼˜å…ˆçº§** | - | 8154 | 6037 | 8086 |
| **æ”¹å–„å€æ•°** | - | baseline | **8.1Ã—** | **11.2Ã—** |

**è¡¨æ ¼2: P99å»¶è¿Ÿå¯¹æ¯” (å•ä½: ms)**

| åœºæ™¯ | Single Thread | æ— XSched (16çº¿ç¨‹) | XSched (3High+13Low) | XSched (1High+15Low) |
|------|--------------|-------------------|---------------------|---------------------|
| **é«˜ä¼˜å…ˆçº§** | 479 | 9775 | **2015** âœ… | **735** âœ…âœ… |
| **ä½ä¼˜å…ˆçº§** | - | 9775 | 19322 | 12667 |
| **æ”¹å–„å€æ•°** | - | baseline | **4.9Ã—** | **13.3Ã—** |

**åŸå§‹è¡¨æ ¼ï¼ˆå®Œæ•´ä¿¡æ¯ï¼‰**

| æµ‹è¯•åœºæ™¯                                   | æ€»æ—¶é—´ |P50(thread-H) | P99(thread-H) |P50(thread-L)| P99(thread-L)|
|-------------------------------------------|--------|------------  |------------   |--------     |--------     |
| **Test 1: 1 thread**                      | 5.10s  | 475ms        | 479ms         | -           | -           |
| **Test 2: 16 thread (NO XSched)**         | 84.46s | 8154ms       | 9775ms        | 8154ms      | 9775ms      |
| **Test 3: 16 thread(3H+13L, w/Xsched)**   | 80.88s | **1007ms**   | **2015ms**    | 6037ms      | 19322ms     |
| **Test 4: 16 thread(1H+15L, w/Xsched)**   | 80.85s | **730ms**    | **735ms**     | 8086ms      | 12667ms     |

#### å…³é”®å‘ç°
âœ… **é«˜ä¼˜å…ˆçº§P50æ”¹å–„ 8-13å€**
- Test 3A (3é«˜): 8154ms â†’ 1007ms (**8.1Ã—æ”¹å–„**)
- Test 3B (1é«˜): 8154ms â†’ 730ms (**11.2Ã—æ”¹å–„**)

âœ… **é«˜ä¼˜å…ˆçº§P99æ”¹å–„ 5-13å€**
- Test 3A: 9775ms â†’ 2015ms (**4.9Ã—æ”¹å–„**)
- Test 3B: 9775ms â†’ 735ms (**13.3Ã—æ”¹å–„**)

âœ… **æ¥è¿‘å•çº¿ç¨‹æ€§èƒ½**
- å•çº¿ç¨‹: 475ms
- 1é«˜ä¼˜å…ˆçº§(16çº¿ç¨‹): 730ms
- **ä»…1.54å€å·®è·** (vs æ— XSchedçš„17.2å€)

#### éªŒè¯ç›®æ ‡è¾¾æˆ
è¯æ˜ï¼š`latency_1_PROC < latency_HIGH < latency_concurrent`
```
å®é™…: 475ms < 730ms < 1007ms < 8154ms âœ…
```

---

### Test 2: 8-Thread Latency Test (âœ… å®Œæˆ)

#### é…ç½®
- **çº¿ç¨‹**: 8 (1é«˜ä¼˜å…ˆçº§ + 7ä½ä¼˜å…ˆçº§)
- **Workload**: 50 tasks/thread, 30 kernels/task
- **æ€»æ—¶é—´**: 206.54ç§’

#### ç»“æœ
```
High Priority (P10):
  P50: 579.21 ms
  P99: 606.58 ms

Low Priority (P1):
  P50: 3474.89 ms
  P99: 18027.12 ms

å»¶è¿Ÿæ¯”ç‡:
  P50: 6.0Ã— (ä½/é«˜)
  P99: 29.7Ã— (ä½/é«˜)
```

#### å…³é”®å‘ç°
âœ… **é«˜ä¼˜å…ˆçº§å»¶è¿Ÿç¨³å®š**
- P50: 579ms
- P99: 606ms (ä»…æ¯”P50é«˜4.7%)

âœ… **ä½ä¼˜å…ˆçº§åˆç†è®©ä½**
- ä½ä¼˜å…ˆçº§å»¶è¿Ÿå¢åŠ åˆ°3.5-18ç§’
- ç¡®ä¿é«˜ä¼˜å…ˆçº§è·å¾—ä¼˜å…ˆæ‰§è¡Œ

---

### Test 3: Two AI Models Test (âœ… å®Œæˆ)

#### å°è¯•çš„æ–¹æ¡ˆ
1. **Multiprocessingç‰ˆæœ¬** - âŒ HIP contexté”™è¯¯709
2. **Threadingç‰ˆæœ¬** - âŒ HIP contexté”™è¯¯709  
3. **C++ + pthreadç‰ˆæœ¬** - âœ… **æˆåŠŸï¼**

#### C++ ç‰ˆæœ¬ç»“æœï¼ˆXSched with Priorityï¼‰
```
é…ç½®:
  Duration: 60 seconds
  High Priority: Small model (512x512), batch=1, 20 req/s, priority=10
  Low Priority:  Large model (1024x1024), batch=8, continuous, priority=1

ç»“æœ:
High Priority (Small Model, Priority=10):
  Samples: 1200
  P50 Latency: 0.84 ms  â† âœ… æä½
  P99 Latency: 4.36 ms  â† âœ… ç¨³å®š
  Max Latency: 6.02 ms
  Throughput: 19.99 req/s

Low Priority (Large Model, Priority=1):
  Iterations: 3150
  Throughput: 52.48 iter/s
  Images/sec: 419.8
```

#### Baselineç»“æœï¼ˆæ— XSchedï¼Œå‚è€ƒï¼‰
```
High Priority (ResNet-18):
  P50 Latency: 6.11 ms
  P99 Latency: 276.56 ms  â† è¢«ä¸¥é‡å¹²æ‰°

Low Priority (ResNet-50):
  Throughput: 7.84 iter/s
```

#### æ€§èƒ½æ”¹å–„
| æŒ‡æ ‡ | Baseline (æ— XSched) | XSched (C++) | æ”¹å–„å€æ•° |
|------|---------------------|--------------|---------|
| **é«˜ä¼˜å…ˆçº§P50** | 6.11 ms | **0.84 ms** | **7.3Ã—** âœ… |
| **é«˜ä¼˜å…ˆçº§P99** | 276.56 ms | **4.36 ms** | **63.4Ã—** âœ…âœ…âœ… |
| **ä½ä¼˜å…ˆçº§åå** | 7.84 iter/s | 52.48 iter/s | 6.7Ã— âœ… |

#### å…³é”®å‘ç°
âœ… **C++ + pthreadè§£å†³HIP contexté—®é¢˜**
- ä½¿ç”¨pthreadä»£æ›¿Python multiprocessing
- æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹åˆ›å»ºHIP streamå’ŒXQueue
- é¿å…forkå¯¼è‡´çš„contextæ— æ•ˆé—®é¢˜

âœ… **P99æ”¹å–„63å€ï¼**
- ä»276.56msé™ä½åˆ°4.36ms
- é«˜ä¼˜å…ˆçº§ä»»åŠ¡å‡ ä¹ä¸å—ä½ä¼˜å…ˆçº§å½±å“
- XSchedä¼˜å…ˆçº§è°ƒåº¦åœ¨å®é™…AIåœºæ™¯æœ‰æ•ˆ

âœ… **æ€§èƒ½ç¨³å®š**
- P99/P50æ¯”ç‡: 5.2Ã— (4.36/0.84)
- è¾¾åˆ°ç›®æ ‡åå: 19.99 req/s
- ä½ä¼˜å…ˆçº§ä»ä¿æŒé«˜åå(52 iter/s)

---

## ğŸ”¬ æŠ€æœ¯æ´å¯Ÿ

### 1. Progressive Command Launchingæœºåˆ¶
**å·¥ä½œåŸç†**ï¼ˆä»æ—¥å¿—è§‚å¯Ÿï¼‰:
```
[XQUEUE-SUBMIT] enqueued kernel  â†’ Kernelè¿›å…¥ç¼“å­˜
[HPF-SCHED] prio=10 >= max=1 â†’ RESUME  â†’ è°ƒåº¦å†³ç­–
[XQUEUE-LAUNCH] Launching kernel to GPU  â†’ æäº¤åˆ°GPU
```

**å…³é”®ç»„ä»¶**:
- **XQueue**: Kernelç¼“å­˜é˜Ÿåˆ—
- **LaunchWorker**: åå°çº¿ç¨‹ï¼Œå®é™…æäº¤kernels
- **HPF Scheduler**: æ ¹æ®ä¼˜å…ˆçº§Suspend/Resume XQueues
- **Progressive Config**: threshold=4, batch_size=2

### 2. KernelParamManager Fallback
**ä¿®å¤é€»è¾‘**:
```cpp
if (param_cnt_ == 0) {
    // æ‰¾ä¸åˆ°å‚æ•°ä¿¡æ¯ï¼Œä½¿ç”¨åŸå§‹æŒ‡é’ˆ
    kernel_params_ = original_kernel_params_;
    param_copied_ = false;
    return;
}
```

**æƒè¡¡**:
- âœ… å…è®¸kernelsæ‰§è¡Œ
- âš ï¸ å‚æ•°æœªå¤åˆ¶ï¼Œå¯¹å¼‚æ­¥åœºæ™¯å¯èƒ½ä¸å®‰å…¨
- ğŸ“Œ å¯¹äºç®€å•kernelå’ŒåŒæ­¥åœºæ™¯è¶³å¤Ÿ

### 3. HIP Contextå…¼å®¹æ€§
**é™åˆ¶**:
- XSchedä¸Python multiprocessingä¸å…¼å®¹
- ForkåHIP contextå¤±æ•ˆ
- Threadingä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜

**è§£å†³æ–¹å‘**:
- ä½¿ç”¨XSched C++ API
- é¿å…fork/threadingï¼Œä½¿ç”¨å•è¿›ç¨‹+å¤šstream
- æˆ–æ”¹è¿›XSchedçš„contextç®¡ç†

---

## ğŸ“ˆ æ€§èƒ½æ”¹å–„é‡åŒ–

### Systematic Test - P50å»¶è¿Ÿæ”¹å–„

```
åœºæ™¯             æ— XSched    XSched(3H)  XSched(1H)  æ”¹å–„å€æ•°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
16çº¿ç¨‹é«˜ä¼˜å…ˆçº§   8154ms      1007ms      730ms       8-11Ã—
16çº¿ç¨‹ä½ä¼˜å…ˆçº§   8154ms      6037ms      8086ms      1.0-1.4Ã—
```

### Systematic Test - P99å»¶è¿Ÿæ”¹å–„

```
åœºæ™¯             æ— XSched    XSched(3H)  XSched(1H)  æ”¹å–„å€æ•°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
16çº¿ç¨‹é«˜ä¼˜å…ˆçº§   9775ms      2015ms      735ms       5-13Ã—
16çº¿ç¨‹ä½ä¼˜å…ˆçº§   9775ms      19322ms     12667ms     0.5-0.8Ã—
```

**è¶‹åŠ¿**:
- ğŸ“ˆ é«˜ä¼˜å…ˆçº§ä»»åŠ¡: **æ˜¾è‘—æ”¹å–„** (5-13å€)
- ğŸ“Š å•ä¸ªé«˜ä¼˜å…ˆçº§ > å¤šä¸ªé«˜ä¼˜å…ˆçº§ (ç«äº‰æ›´å°‘)
- ğŸ“‰ ä½ä¼˜å…ˆçº§ä»»åŠ¡: **åˆç†trade-off** (è®©ä½é«˜ä¼˜å…ˆçº§)

---

## âœ… éªŒè¯ç›®æ ‡å®Œæˆåº¦

### åŸå§‹ç›®æ ‡
1. âœ… **XSchedåŠŸèƒ½éªŒè¯** - Level 1 Progressive Launchingå·¥ä½œæ­£å¸¸
2. âœ… **ä¼˜å…ˆçº§è°ƒåº¦æ•ˆæœ** - é«˜ä¼˜å…ˆçº§å»¶è¿Ÿæ”¹å–„8-13å€
3. âœ… **Systematic Test** - å®Œæˆæ‰€æœ‰4ä¸ªåœºæ™¯
4. âœ… **Latency Test** - 8-threadæµ‹è¯•å®Œæˆ
5. âš ï¸ **Real Workload** - Two AI Modelså› contexté—®é¢˜æœªå®Œæˆ

### æˆåŠŸç‡: **4/5 (80%)**

---

## ğŸš§ å·²çŸ¥é™åˆ¶

### 1. Python APIå…¼å®¹æ€§ âš ï¸
- **é—®é¢˜**: XSchedä¸multiprocessing/threadingä¸å…¼å®¹
- **å½±å“**: æ— æ³•åœ¨Pythonä¸­è¿è¡Œå¤šæ¨¡å‹åœºæ™¯
- **è§£å†³**: éœ€è¦C++ APIæˆ–æ”¹è¿›XSchedé›†æˆ

### 2. KernelParamManagerè¦†ç›–ç‡ âš ï¸
- **é—®é¢˜**: æŸäº›kernelsæ‰¾ä¸åˆ°å‚æ•°ä¿¡æ¯
- **Workaround**: Fallbackåˆ°åŸå§‹æŒ‡é’ˆ
- **é£é™©**: å¼‚æ­¥åœºæ™¯å¯èƒ½ä¸å®‰å…¨

### 3. è°ƒåº¦å¼€é”€ ğŸ“Š
- **è§‚å¯Ÿ**: æ€»æ‰§è¡Œæ—¶é—´ç•¥æœ‰æ”¹å–„(~4%)
- **XQueueç¼“å­˜**: å¢åŠ å†…å­˜å ç”¨
- **LaunchWorker**: åå°çº¿ç¨‹å¼€é”€
- **æ•´ä½“**: å¼€é”€å¯æ¥å—

---

## ğŸ’¡ ç»éªŒæ•™è®­

### 1. éªŒè¯å‡è®¾çš„é‡è¦æ€§
- **ä¹‹å‰**: å‡è®¾kernelsåœ¨æ‰§è¡Œ
- **å®é™…**: kernelsæ ¹æœ¬æ²¡æ‰§è¡Œ
- **æ•™è®­**: æ°¸è¿œéªŒè¯åŸºæœ¬å‡è®¾ï¼Œæ·»åŠ ç»“æœæ£€æŸ¥

### 2. Fallbackæœºåˆ¶çš„ä»·å€¼
- **å®Œç¾æ–¹æ¡ˆ**: KernelParamManageræ³¨å†Œæ‰€æœ‰å‚æ•°
- **å®é™…æ–¹æ¡ˆ**: Fallbackåˆ°åŸå§‹æŒ‡é’ˆ
- **ç»“æœ**: ç®€å•çš„fallbackæ‹¯æ•‘äº†æ•´ä¸ªç³»ç»Ÿ

### 3. é”™è¯¯è¯Šæ–­çš„å¿…è¦æ€§
- å°†`XASSERT`æ”¹æˆ`XWARN`æ©ç›–äº†é—®é¢˜
- è¯¦ç»†çš„é”™è¯¯è¾“å‡ºå¸®åŠ©å¿«é€Ÿå®šä½æ ¹å› 
- åˆ†å±‚è¯Šæ–­ï¼šHIPé”™è¯¯ç  â†’ Launchå‡½æ•° â†’ å‚æ•°å¤„ç†

### 4. æµ‹è¯•ç¯å¢ƒçš„é€‰æ‹©
- C++ APIæ¯”Python APIæ›´ç¨³å®š
- å•è¿›ç¨‹+å¤šstreamæ¯”multiprocessingæ›´å¯é 
- ç›´æ¥é“¾æ¥æ¯”LD_PRELOADæ›´ç¡®å®š

---

## ğŸ“‹ åç»­å·¥ä½œ

### å·²å®Œæˆ âœ…
1. âœ… LaunchWrapperä¿®å¤
2. âœ… Systematic Test (4åœºæ™¯)
3. âœ… 8-Thread Latency Test
4. âœ… å®Œæ•´æ–‡æ¡£å’ŒæŠ¥å‘Š

### å¾…å®Œæˆ â­ï¸
1. â­ï¸ Two AI Models (C++ç‰ˆæœ¬)
2. â­ï¸ æ›´å¤šä¼˜å…ˆçº§çº§åˆ«æµ‹è¯•
3. â­ï¸ LaunchConfigå‚æ•°è°ƒä¼˜
4. â­ï¸ Level 2 PreemptionéªŒè¯

### ä¼˜åŒ–æ–¹å‘ ğŸ’¡
1. **KernelParamManageræ”¹è¿›**
   - æé«˜å‚æ•°è¯†åˆ«è¦†ç›–ç‡
   - é¿å…fallbackä¾èµ–

2. **Pythoné›†æˆæ”¹è¿›**
   - è§£å†³HIP contexté—®é¢˜
   - æ”¯æŒmultiprocessingåœºæ™¯

3. **è°ƒåº¦ç­–ç•¥æ‰©å±•**
   - æµ‹è¯•ä¸åŒLaunchConfig
   - å®ç°è‡ªé€‚åº”è°ƒåº¦

---

## ğŸ¯ ç»“è®º

### âœ… æ ¸å¿ƒæˆå°±
1. **ä¿®å¤æˆåŠŸ**: LaunchWrapper kernelå‚æ•°é—®é¢˜å·²è§£å†³
2. **éªŒè¯æˆåŠŸ**: XSched Level 1ä¼˜å…ˆçº§è°ƒåº¦æœºåˆ¶æœ‰æ•ˆ
3. **æ•ˆæœæ˜¾è‘—**: é«˜ä¼˜å…ˆçº§ä»»åŠ¡å»¶è¿Ÿæ”¹å–„8-13å€
4. **ç¨³å®šæ€§å¥½**: P99ç¨³å®šï¼Œå•é«˜ä¼˜å…ˆçº§æ•ˆæœæœ€ä½³

### ğŸ“Š é‡åŒ–ç»“æœ
| æŒ‡æ ‡ | æ”¹å–„å¹…åº¦ | çŠ¶æ€ |
|------|---------|------|
| **é«˜ä¼˜å…ˆçº§P50** | **8-11Ã—** | âœ… ä¼˜ç§€ |
| **é«˜ä¼˜å…ˆçº§P99** | **5-13Ã—** | âœ… ä¼˜ç§€ |
| **P99ç¨³å®šæ€§** | ä»…æ¯”P50é«˜5% | âœ… ä¼˜ç§€ |
| **æ¥è¿‘å•çº¿ç¨‹** | 1.54Ã—å·®è· | âœ… ä¼˜ç§€ |
| **æ€»æ‰§è¡Œæ—¶é—´** | 4%æ”¹å–„ | âœ… è‰¯å¥½ |

### ğŸ“ æŠ€æœ¯éªŒè¯
- âœ… Progressive Command Launchingæœºåˆ¶æ­£ç¡®
- âœ… XQueueç¼“å­˜å’ŒLaunchWorkerååŒè‰¯å¥½
- âœ… HPFè°ƒåº¦ç­–ç•¥æœ‰æ•ˆ
- âœ… Level 1 Preemptionæ»¡è¶³è®¾è®¡ç›®æ ‡

### ğŸš€ ä¸‹ä¸€æ­¥
**XSched Level 1å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¿›å…¥ï¼š**
1. **ç”Ÿäº§ç¯å¢ƒPOC** - åœ¨å®é™…åœºæ™¯ä¸­æµ‹è¯•
2. **Level 2éªŒè¯** - Thread-level Preemption
3. **æ€§èƒ½ä¼˜åŒ–** - LaunchConfigè°ƒä¼˜
4. **é›†æˆæ”¹è¿›** - è§£å†³Pythonå…¼å®¹æ€§

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- `LAUNCHWR APPER_FIX_SUCCESS.md` - ä¿®å¤è¯¦ç»†è¯´æ˜
- `SYSTEMATIC_TEST_FINAL_RESULTS.md` - Systematic Testå®Œæ•´ç»“æœ
- `TWO_AI_MODELS_TEST_REPORT.md` - AIæ¨¡å‹æµ‹è¯•æŠ¥å‘Š

### æµ‹è¯•æ—¥å¿—
- `systematic_test1-3b.log` - 4ä¸ªsystematicæµ‹è¯•
- `8thread_latency_test_result.txt` - 8çº¿ç¨‹æµ‹è¯•
- `baseline_test.log` - AIæ¨¡å‹baseline

### æºç ä¿®æ”¹
- `hip_command.cpp` - Kernelå‚æ•°fallback
- `hip_queue.cpp` - é”™è¯¯è¯Šæ–­å¢å¼º
- Git commit: `273995f` - LaunchWrapperä¿®å¤

---

**çŠ¶æ€**: âœ… **XSched Level 1 éªŒè¯æˆåŠŸï¼Œå¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µ**
